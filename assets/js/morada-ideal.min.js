let autocomplete,map,lat=ajax_object.lat,lng=ajax_object.lng,itemsLista=Object.values(ajax_object.imoveis),todosImoveis=itemsLista,allInfoWindows=[],markers={};function initMap(){var e,t=document.getElementById("map");t&&(console.log("initMap 2"),lat,lat)&&(lng,lng)&&(console.log("initMap 3"),lat=Number(lat),lng=Number(lng),e={lat:lat,lng:lng},map=new google.maps.Map(t,{zoom:15,center:e,mapTypeControl:!1}),todosImoveis.forEach((e,t)=>{var a={lat:parseFloat(e.lat),lng:parseFloat(e.lng)};let o=`<div>
                <h5><a href="${e.post_url}">${e.title}</a></h5>
                <address>
                Endereço: ${e.rua}, ${e.numero} - ${e.cidade} / ${e.estado}, ${e.codigo_postal}
                </address>
            </div>`,i=new google.maps.InfoWindow({content:o,ariaLabel:e.title});allInfoWindows.push(i);var n,a=new google.maps.Marker({position:a,map:map,title:e.title});google.maps.event.addListener(a,"click",(n=a,function(){closeAllInfoWindows(),i.setContent(o),i.open(map,n),map.setZoom(16),map.setCenter(n.getPosition())})),markers[e.post_id]=a,console.log("initMap 4")}))}function closeAllInfoWindows(){for(var e of allInfoWindows)e.close()}function miFormsValidation(){var e=document.querySelectorAll(".needs-validation");Array.from(e).forEach(t=>{t.addEventListener("submit",e=>{t.checkValidity()||(e.preventDefault(),e.stopPropagation()),t.classList.add("was-validated")},!1)})}function miPasswordStrength(){let t=document.getElementById("user_pass");if(t,t){let e=document.querySelectorAll(".meter-section");e.length<=0||t.addEventListener("keyup",()=>miUpdateMeter(t,e))}}function miUpdateMeter(e,t){e=miCalculatePasswordStrength(e.value);t.forEach(e=>{e.classList.remove("weak","medium","strong","very-strong")}),1<=e&&t[0].classList.add("weak"),2<=e&&t[1].classList.add("medium"),3<=e&&t[2].classList.add("strong"),4<=e&&t[3].classList.add("very-strong"),console.log("strength",e)}function miCalculatePasswordStrength(e){let t=0;return t+=.2*e.length,/[A-Z]/.test(e)&&(t+=.5),/[a-z]/.test(e)&&(t+=.5),/\d/.test(e)&&(t+=.7),/[^A-Za-z0-9]/.test(e)&&(t+=1),t}function miInitToasts(){var e=document.querySelectorAll(".toast");Array.from(e).forEach(e=>{console.log("toasts"),bootstrap.Toast.getOrCreateInstance(e).show()})}function inputMasks(){var e=document.getElementById("user_phone"),e=(e&&IMask(e,{mask:"(00) 0000-0000[0]"}),document.getElementById("user_whatsapp")),e=(e&&IMask(e,{mask:"(00) 0000-00000"}),document.getElementById("imovel_price")),t={mask:"num",blocks:{num:{mask:Number,scale:2,thousandsSeparator:".",padFractionalZeros:!0,radix:",",mapToRadix:["."]}}};e&&IMask(e,t)}function miGoBackBtn(){var e=document.querySelectorAll(".go-back-btn");Array.from(e).forEach(e=>{e.addEventListener("click",e=>{e.preventDefault(),history.back()})})}function miLimitFileUploadSize(){var e=document.querySelectorAll('input[type="file"]');Array.from(e).forEach(e=>{e.onchange=function(){2097152<this.files[0].size&&(alert("O arquivo é muito pesado, o tamanho máximo permitido é de 2MB."),this.value="")}})}function miTooltips(){[...document.querySelectorAll('[data-bs-toggle="tooltip"]')].map(e=>new bootstrap.Tooltip(e))}function miFileImagePreview(){document.querySelectorAll(".mi-file-image-preview").forEach(e=>{let o=e.querySelector('input[type="file"]'),i=e.querySelector(".images-preview"),n=e.querySelector(".btn-clear-image"),l=e.querySelector('input[name="changed-thumbnail"]');n.addEventListener("click",e=>{for(e.preventDefault(),o.value=null;i.firstChild;)i.removeChild(i.lastChild);n.style.display="none",l.value="true"}),o.addEventListener("change",e=>{for(var t,e=e.target.files;i.firstChild;)i.removeChild(i.lastChild);for(t of e){var a=document.createElement("img");a.classList.add("image-preview"),a.src=URL.createObjectURL(t),i.append(a)}n.style.display="block",l.value="true",console.log("fileInput",o.value)})})}function miClearInputValue(){document.querySelectorAll(".clear-input-value").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault();e=document.getElementById(t.dataset.input);e&&(e.value="")})})}function mi_show_alert(e,t,a){var o=document.createElement("div");o.innerHTML=[`<div id="contact-form-alert" class="alert alert-${a} alert-dismissible" role="alert">`,`   <div>${t}</div>`,'   <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>',"</div>"].join(""),e.append(o)}function miContactForm(){document.querySelectorAll(".mi-contact-form").forEach(s=>{s.addEventListener("submit",l=>{if(l.preventDefault(),document.getElementById("contact-form-alert"),document.getElementById("contact-form-alert")&&bootstrap.Alert.getOrCreateInstance("#contact-form-alert").close(),s.checkValidity()){s.classList.add("was-validated");let a=s.querySelector("#nome"),o=s.querySelector("#email"),i=s.querySelector("#mensagem"),n=s.querySelector("button");if(n,n&&!n.disabled){n.disabled=!0;let e=n.innerText;n.innerText="Enviando...";var l=ajax_object.ajax_url,r=new FormData(s);r.get("action");let t=document.getElementById("contact-form-alert-placeholder");fetch(l,{method:"POST",body:r}).then(e=>e.json()).then(e=>{mi_show_alert(t,e.data.msg,"success"),a.value="",o.value="",i.value=""}).catch(e=>{mi_show_alert(t,e,"danger")}).finally(()=>{n.disabled=!1,n.innerText=e,s.classList.remove("was-validated")})}}})})}function miNewsletterForm(){document.querySelectorAll(".mi-newsletter-form").forEach(l=>{l.addEventListener("submit",i=>{if(i.preventDefault(),document.getElementById("newsletter-form-alert"),document.getElementById("newsletter-form-alert")&&bootstrap.Alert.getOrCreateInstance("#newsletter-form-alert").close(),l.checkValidity()){l.classList.add("was-validated");let a=l.querySelector("#email"),o=l.querySelector("button");if(o,o&&!o.disabled){o.disabled=!0;let e=o.innerText;o.innerText="Enviando...";var i=ajax_object.ajax_url,n=new FormData(l);n.get("action");let t=document.getElementById("newsletter-form-alert-placeholder");fetch(i,{method:"POST",body:n}).then(e=>e.json()).then(e=>{mi_show_alert(t,e.data.msg,"success"),a.value=""}).catch(e=>{mi_show_alert(t,e,"danger")}).finally(()=>{o.disabled=!1,o.innerText=e,l.classList.remove("was-validated")})}}})})}function miSortTableList(){var e={page:10,pagination:[{item:'<li class="page-item"><a class="page page-link"></a></li>'}]},t={...e,valueNames:["nome","data"]},e={...e,valueNames:["nome"],page:10},a=document.getElementById("table-operacao-imoveis"),a=(new List(a,e),document.getElementById("table-tipo-imoveis")),a=(new List(a,e),document.getElementById("table-regiao-imoveis")),a=(new List(a,e),document.getElementById("table-caracteristicas-gerais-imoveis")),a=(new List(a,e),document.getElementById("table-tipologia-imoveis")),a=(new List(a,e),document.getElementById("table-outras-denominacoes-imoveis")),a=(new List(a,e),document.getElementById("table-casas-de-banho-imoveis")),a=(new List(a,e),document.getElementById("table-estado-imoveis")),a=(new List(a,e),document.getElementById("table-filtro-imoveis")),a=(new List(a,e),document.getElementById("table-andar-imoveis")),a=(new List(a,e),document.getElementById("my-imoveis"));new List(a,t)}function miFaq(){var e=document.querySelectorAll(".mi-caracteristicas-especificas-group");Array.from(e).forEach(e=>{var t=e.querySelector(".mi-caracteristicas-especificas-group-list"),a=e.querySelectorAll(".list-group-item"),o=e.querySelector(".mi-group-new-item-btn");!a||a.length<=0?console.error("Não foi encontrado nenhum item da lista de perguntas e respostas (FAQ)."):t?o?(miAddNewFaqItemEvent(o,e),miAddRemoveFaqItemEvent(e)):console.error("Não foi encontrado o botão para adicionar novos itens na lista de perguntas e respostas (FAQ)."):console.error("Não foi encontrado a lista de itens de perguntas e respostas (FAQ).")})}function miRecalcFaqItems(e){var t=e.querySelector(".mi-caracteristicas-especificas-group-list"),e=e.querySelectorAll(".list-group-item");if(!e||e.length<=0)console.error("Não foi encontrado nenhum item da lista de perguntas e respostas (FAQ).");else{if(t)return Array.from(e).forEach((e,t)=>{let a="imovel_caracteristicas-pergunta-"+(e.dataset.faqGroupItemId=t),o="imovel_caracteristicas-resposta-"+t;t=e.querySelectorAll("label"),e=e.querySelectorAll("input");t.forEach((e,t)=>{0===t?e.setAttribute("for",a):e.setAttribute("for",o)}),e.forEach((e,t)=>{0===t&&(e.id=a)})}),e.length;console.error("Não foi encontrado a lista de itens de perguntas e respostas (FAQ).")}}function miAddNewFaqItemEvent(e,t){var a=t.querySelector(".mi-caracteristicas-especificas-group-list");a?e.addEventListener("click",miAddNewFaqItem.bind(null,a,t)):console.error("Não foi encontrado a lista de itens de perguntas e respostas (FAQ).")}function miAddNewFaqItem(e,t,a){a.preventDefault();var a=document.createElement("li"),o=(a.classList.add("mi-caracteristicas-especificas-group-item"),a.classList.add("list-group-item"),a.id="mi-caracteristicas-especificas-group-item-",a.dataset.faqGroupItemId="",document.createElement("label")),o=(o.setAttribute("for","imovel_caracteristicas-especificas-"),o.classList.add("form-label"),o.innerText="Característica",a.append(o),document.createElement("input")),o=(o.setAttribute("type","text"),o.classList.add("form-control"),o.id="imovel_caracteristicas-especificas-",o.name="imovel_caracteristicas-especificas[]",a.append(o),document.createElement("div")),o=(o.classList.add("invalid-feedback"),o.innerText="Campo obrigatório",a.append(o),document.createElement("div")),i=(o.classList.add("d-flex"),document.createElement("a"));i.classList.add("mi-delete-caracteristicas-especificas-group"),i.classList.add("btn"),i.classList.add("btn-danger"),i.classList.add("btn-sm"),i.classList.add("mt-2"),i.classList.add("ms-auto"),i.innerHTML='<i class="bi bi-x-circle-fill"></i> Remover item',o.append(i),a.append(o),e.append(a),miAddRemoveFaqItemEvent(t),miRecalcFaqItems(t)}function miAddRemoveFaqItemEvent(t){var e=document.querySelectorAll(".mi-delete-caracteristicas-especificas-group");Array.from(e).forEach(e=>{e.removeEventListener("click",miRemoveFaqItem),e.addEventListener("click",miRemoveFaqItem.bind(null,t))})}function miRemoveFaqItem(e,t){t.preventDefault();e=miRecalcFaqItems(e),t=t.target.closest(".mi-caracteristicas-especificas-group-item");1<e?t.remove():t.querySelector("input").value=""}function miRangeSliderDoubleValue(){function v(e,t){return ajax_object[t][0<e?e:0][0]}function g(e,t){t=ajax_object[t];let a=[];return t.forEach((e,t)=>{a[t]=e[1]}),a[0<e?e:0]}function f(e,t){return[parseInt(e.value,10),parseInt(t.value,10)]}function y(e,t,a,o,i){var n=t.max-t.min,e=e.value-t.min,t=t.value-t.min;i.style.background=`linear-gradient(
      to right,
      ${a} 0%,
      ${a} ${e/n*100}%,
      ${o} ${e/n*100}%,
      ${o} ${t/n*100}%, 
      ${a} ${t/n*100}%, 
      ${a} 100%)`}function b(e){var t=document.querySelector("#toSlider");Number(e.value)<=0?t.style.zIndex=2:t.style.zIndex=0}document.querySelectorAll(".range-container").forEach(e=>{let r=e.querySelector(".fromSlider"),s=e.querySelector(".toSlider"),c=e.querySelector(".fromInput"),m=e.querySelector(".toInput"),d=e.querySelector(".text-min-value"),u=e.querySelector(".text-max-value"),p=e.getAttribute("data-array-id");y(r,s,"#E7F0FF","rgba(90, 77, 140, 1)",s),b(s),r.oninput=()=>{var e=r,t=s,a=c,o=d,i=p,[n,l]=f(e,t);y(e,t,"#E7F0FF","rgba(90, 77, 140, 1)",t),l<n?(e.value=l,a.value=v(l,i),o.innerText=g(l,i)):(a.value=v(n,i),o.innerText=g(n,i))},s.oninput=()=>{var e=r,t=s,a=m,o=u,i=p,[n,l]=f(e,t);y(e,t,"#E7F0FF","rgba(90, 77, 140, 1)",t),b(t),n<=l?(t.value=l,a.value=v(l,i),o.innerText=g(l,i)):(a.value=v(n,i),t.value=n,o.innerText=g(n,i))},c.oninput=()=>{var e=r,t=c,a=m,o=s,[i,n]=f(t,a);y(t,a,"#E7F0FF","rgba(90, 77, 140, 1)",o),n<i?(e.value=n,t.value=n):e.value=i},m.oninput=()=>{var e=s,t=c,a=m,o=s,[i,n]=f(t,a);y(t,a,"#E7F0FF","rgba(90, 77, 140, 1)",o),b(a),i<=n?(e.value=n,a.value=n):a.value=i}})}function miNormalizeText(e){let t=e.toLowerCase(),a={"á":"a","à":"a","ã":"a","â":"a","ä":"a","é":"e","è":"e","ê":"e","ë":"e","í":"i","ì":"i","î":"i","ï":"i","ó":"o","ò":"o","õ":"o","ô":"o","ö":"o","ú":"u","ù":"u","û":"u","ü":"u","ç":"c","ñ":"n"};return t=(t=t.replace(/[áàãâäéèêëíìîïóòõôöúùûüçñ]/g,e=>a[e])).replace(/\s+/g,"-")}function miInitAutocomplete(){document.querySelectorAll(".autocomplete-wrapper").forEach(t=>{var a=t.querySelector(".autocomplete");if(a){autocomplete=new google.maps.places.Autocomplete(a,{componentRestrictions:{country:["PT"]},fields:["place_id","geometry","name","address_components"]});let e=t.querySelector(".autocomplete-message");a.addEventListener("change",e=>{}),autocomplete.addListener("place_changed",()=>miOnPlaceChanged(e))}})}function miOnPlaceChanged(t){var a=autocomplete.getPlace(),o=(console.log("place",a),t.closest("form"));if(o){var i=o.querySelector('input[name="lat"]'),n=o.querySelector('input[name="lng"]'),l=o.querySelector('input[name="imovel_estado"]'),r=o.querySelector('input[name="imovel_cidade"]'),s=o.querySelector('input[name="imovel_codigo_postal"]'),o=o.querySelector('input[name="imovel_rua"]'),c=document.getElementById("new-imovel-form-btn");let e="";if(c&&c.setAttribute("disabled",""),t&&(t.style.display="block"),i)if(n)if(a.geometry){lat=a.geometry.location.lat(),lng=a.geometry.location.lng();var m=a.address_components.filter(e=>e.types.includes("administrative_area_level_1")),d=a.address_components.filter(e=>e.types.includes("administrative_area_level_2")),u=a.address_components.filter(e=>e.types.includes("postal_code")),p=a.address_components.filter(e=>e.types.includes("route")),a=(document.getElementById("autocomplete").innerHTML=a.name,i.value=lat,n.value=lng,l&&(l.value=m[0]?.short_name||""),r&&(r.value=d[0]?.short_name||""),s&&(s.value=u[0]?.short_name||""),o&&(o.value=p[0]?.long_name||""),document.getElementById("table-regiao-imoveis"));if(a){d=a.querySelector('[type="search"');if(d){d.value=m[0]?.short_name,d.dispatchEvent(new Event("keyup"));let a=miNormalizeText(m[0]?.short_name);(e=document.querySelectorAll('[name="regiao-terms[]"]')).forEach(e=>{var t=miNormalizeText(e.getAttribute("data-name"));a===t&&(e.checked=!0,e.dispatchEvent(new Event("change")))})}}t.style.display="none",c&&c.removeAttribute("disabled")}else{document.getElementById("autocomplete").placeholder="Digite um endereço",i.value="",n.value="",tateInput&&(l.value=""),r&&(r.value=""),s&&(s.value=""),o&&(o.value=""),t.style.display="block",c&&c.setAttribute("disabled","");u=document.getElementById("table-regiao-imoveis");u&&(p=u.querySelector('[type="search"'))&&((e=document.querySelectorAll('[name="regiao-terms[]"]')).forEach(e=>{e.checked=!1,e.dispatchEvent(new Event("change"))}),p.value="",p.dispatchEvent(new Event("keyup")))}else console.error("Não foi possível encontrar o input de longitude");else console.error("Não foi possível encontrar o input de latitude")}else console.error("Não foi possível encontrar o formulário do autocomplete")}function initGoogleApi(){window.addEventListener("load",function(){initMap(),miInitAutocomplete()})}document.addEventListener("DOMContentLoaded",function(){miFormsValidation(),miPasswordStrength(),miInitToasts(),inputMasks(),miGoBackBtn(),miLimitFileUploadSize(),miTooltips(),miFileImagePreview(),miClearInputValue(),miContactForm(),miNewsletterForm(),miSortTableList(),miFaq(),miRangeSliderDoubleValue()}),initGoogleApi();